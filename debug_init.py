import os
from app import create_app, db
from app.models import Habit

app = create_app()


def debug_database():
    with app.app_context():
        print("üîç –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:")

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—É—Ç–∏
        db_path = app.config['SQLALCHEMY_DATABASE_URI']
        print(f"üìÅ –ü—É—Ç—å –∫ –ë–î –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞: {db_path}")

        # –ü—ã—Ç–∞–µ–º—Å—è —Å–æ–∑–¥–∞—Ç—å –ë–î
        try:
            print("üîÑ –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—ã...")
            db.create_all()
            print("‚úÖ –¢–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ!")

            # –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
            print("üîÑ –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏...")
            if Habit.query.count() == 0:
                habits = [
                    # üí° –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ –§–æ–∫—É—Å
                    Habit(name="–†–µ–≥—É–ª—è—Ä–Ω—ã–π —Å–æ–Ω", description="–õ–æ–∂–∏—Ç—å—Å—è –∏ –≤—Å—Ç–∞–≤–∞—Ç—å –≤ –æ–¥–Ω–æ –≤—Ä–µ–º—è –¥–∞–∂–µ –≤ –≤—ã—Ö–æ–¥–Ω—ã–µ"),
                    Habit(name="–í–æ–¥–∞ —Å —É—Ç—Ä–∞", description="–í—ã–ø–∏—Ç—å —Å—Ç–∞–∫–∞–Ω –≤–æ–¥—ã —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏—è"),
                    Habit(name="–ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ", description="30 –º–∏–Ω—É—Ç —Ö–æ–¥—å–±—ã, –∑–∞—Ä—è–¥–∫–∏ –∏–ª–∏ —Ä–∞—Å—Ç—è–∂–∫–∏"),
                    Habit(name="–ü—Ä–∞–≤–∏–ª–æ ¬´1-3-5¬ª –Ω–∞ –¥–µ–Ω—å", description="–ü–ª–∞–Ω–∏—Ä—É–π—Ç–µ —Å–≤–æ–π –¥–µ–Ω—å —Ç–∞–∫: 1 –ö–†–£–ü–ù–û–ï –¥–µ–ª–æ, 3 –°–†–ï–î–ù–ò–• –¥–µ–ª–∞ –∏ 5 –ú–ï–õ–ö–ò–• –¥–µ–ª."),

                    # üß† –ú—ã—à–ª–µ–Ω–∏–µ –∏ –ü—Å–∏—Ö–∏—á–µ—Å–∫–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ
                    Habit(name="–ú–∏–∫—Ä–æ-–æ–±—É—á–µ–Ω–∏–µ", description="–í—ã–¥–µ–ª–∏—Ç–µ 15-20 –º–∏–Ω—É—Ç –≤ –¥–µ–Ω—å –Ω–∞ –∏–∑—É—á–µ–Ω–∏–µ —á–µ–≥–æ-—Ç–æ –Ω–æ–≤–æ–≥–æ"),
                    Habit(name="–í–µ—á–µ—Ä–Ω—è—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞", description="–ü–æ—Ç—Ä–∞—Ç—å—Ç–µ 10 –º–∏–Ω—É—Ç –≤–µ—á–µ—Ä–æ–º –Ω–∞ —Ç–æ, —á—Ç–æ–±—ã –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —á—Ç–æ-—Ç–æ, –ø–æ–º—ã—Ç—å –ø–æ—Å—É–¥—É"),
                    Habit(name="–ß–∏—Ç–∞–π—Ç–µ 10 —Å—Ç—Ä–∞–Ω–∏—Ü –≤ –¥–µ–Ω—å", description="–≠—Ç–æ –æ–∫–æ–ª–æ 15-20 –º–∏–Ω—É—Ç. –ó–∞ –≥–æ–¥ –≤—ã –ø—Ä–æ—á–∏—Ç–∞–µ—Ç–µ 12-15 –∫–Ω–∏–≥."),


                ]

                for habit in habits:
                    db.session.add(habit)

                db.session.commit()
                print("–ü—Ä–∏–≤—ã—á–∫–∏ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö!")
                for habit in habits:
                    db.session.add(habit)
                db.session.commit()
                print("‚úÖ –¢–µ—Å—Ç–æ–≤—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã!")
            else:
                print("‚úÖ –ü—Ä–∏–≤—ã—á–∫–∏ —É–∂–µ –µ—Å—Ç—å –≤ –±–∞–∑–µ")

            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –ë–î
            db_file_path = db_path.replace('sqlite:///', '')
            print(f"üìÅ –§–∞–π–ª –ë–î —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: {os.path.exists(db_file_path)}")
            if os.path.exists(db_file_path):
                print(f"üìÅ –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: {os.path.getsize(db_file_path)} –±–∞–π—Ç")

        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
            import traceback
            traceback.print_exc()


if __name__ == '__main__':
    debug_database()