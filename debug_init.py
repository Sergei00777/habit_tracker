import os
from app import create_app, db
from app.models import Habit

app = create_app()


def debug_database():
    with app.app_context():
        print("üîç –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:")

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—É—Ç–∏
        db_path = app.config['SQLALCHEMY_DATABASE_URI']
        print(f"üìÅ –ü—É—Ç—å –∫ –ë–î –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞: {db_path}")

        # –ü—ã—Ç–∞–µ–º—Å—è —Å–æ–∑–¥–∞—Ç—å –ë–î
        try:
            print("üîÑ –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—ã...")
            db.create_all()
            print("‚úÖ –¢–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ!")

            # –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
            print("üîÑ –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏...")
            if Habit.query.count() == 0:
                habits = [
                    # üí° –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ –§–æ–∫—É—Å
                    Habit(name="–°—ä–µ—Å—Ç—å –ª—è–≥—É—à–∫—É —É—Ç—Ä–æ–º", description="–í—ã–ø–æ–ª–Ω–∏—Ç—å —Å–∞–º–æ–µ —Å–ª–æ–∂–Ω–æ–µ –¥–µ–ª–æ –ø–µ—Ä–≤—ã–º –¥–µ–ª–æ–º —Å —É—Ç—Ä–∞"),
                    Habit(name="–í–µ—á–µ—Ä–Ω–µ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ",
                          description="–ü–æ—Ç—Ä–∞—Ç–∏—Ç—å 5 –º–∏–Ω—É—Ç –Ω–∞ –ø–ª–∞–Ω –∑–∞–¥–∞—á –Ω–∞ –∑–∞–≤—Ç—Ä–∞—à–Ω–∏–π –¥–µ–Ω—å"),
                    Habit(name="–¢–µ—Ö–Ω–∏–∫–∞ Pomodoro", description="–†–∞–±–æ—Ç–∞—Ç—å 25 –º–∏–Ω—É—Ç, –∑–∞—Ç–µ–º 5 –º–∏–Ω—É—Ç –æ—Ç–¥—ã—Ö–∞"),
                    Habit(name="–ü—Ä–∞–≤–∏–ª–æ –æ–¥–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ–Ω—Ç–∞", description="–£–ª—É—á—à–∞—Ç—å –Ω–∞–≤—ã–∫ –Ω–∞ 1% –∫–∞–∂–¥—ã–π –¥–µ–Ω—å"),
                    Habit(name="–ú–µ—Ç–æ–¥ '–¢–æ–ª—å–∫–æ –Ω–∞—á–∞—Ç—å'", description="–ù–∞—á–∞—Ç—å –∑–∞–¥–∞—á—É –≤—Å–µ–≥–æ –Ω–∞ 5-10 –º–∏–Ω—É—Ç"),

                    # üß† –ú—ã—à–ª–µ–Ω–∏–µ –∏ –ü—Å–∏—Ö–∏—á–µ—Å–∫–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ
                    Habit(name="–î–Ω–µ–≤–Ω–∏–∫ –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏", description="–ó–∞–ø–∏—Å–∞—Ç—å 3 –≤–µ—â–∏, –∑–∞ –∫–æ—Ç–æ—Ä—ã–µ –±–ª–∞–≥–æ–¥–∞—Ä–µ–Ω —Å–µ–≥–æ–¥–Ω—è"),
                    Habit(name="–£—Ç—Ä–µ–Ω–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã", description="–í—ã–ø–∏—Å–∞—Ç—å –≤—Å–µ –º—ã—Å–ª–∏ –Ω–∞ 3 –ª–∏—Å—Ç–∞ –ø–æ—Å–ª–µ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏—è"),
                    Habit(name="–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã",
                          description="–°–ø—Ä–æ—Å–∏—Ç—å '–ö–∞–∫ —Ä–µ—à–∏—Ç—å?' –≤–º–µ—Å—Ç–æ '–ü–æ—á–µ–º—É —è –Ω–µ—É–¥–∞—á–Ω–∏–∫?'"),
                    Habit(name="–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –¥–∏–µ—Ç–∞", description="–û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–µ–π –∏ —Å–æ—Ü—Å–µ—Ç–µ–π"),
                    Habit(name="–¶–∏—Ñ—Ä–æ–≤–æ–π –¥–µ—Ç–æ–∫—Å", description="–ü—Ä–æ–≤–µ—Å—Ç–∏ 1 —á–∞—Å –±–µ–∑ –≥–∞–¥–∂–µ—Ç–æ–≤"),

                    # üí™ –§–∏–∑–∏—á–µ—Å–∫–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ –∏ –≠–Ω–µ—Ä–≥–∏—è
                    Habit(name="–í–æ–¥–∞ —Å —É—Ç—Ä–∞", description="–í—ã–ø–∏—Ç—å —Å—Ç–∞–∫–∞–Ω –≤–æ–¥—ã —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏—è"),
                    Habit(name="–ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ", description="30 –º–∏–Ω—É—Ç —Ö–æ–¥—å–±—ã, –∑–∞—Ä—è–¥–∫–∏ –∏–ª–∏ —Ä–∞—Å—Ç—è–∂–∫–∏"),
                    Habit(name="–ü—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ –µ–¥—ã", description="–ó–∞–≥–æ—Ç–æ–≤–∏—Ç—å –∑–¥–æ—Ä–æ–≤—É—é –µ–¥—É –Ω–∞ –Ω–µ–¥–µ–ª—é"),
                    Habit(name="–†–µ–≥—É–ª—è—Ä–Ω—ã–π —Å–æ–Ω", description="–õ–æ–∂–∏—Ç—å—Å—è –∏ –≤—Å—Ç–∞–≤–∞—Ç—å –≤ –æ–¥–Ω–æ –≤—Ä–µ–º—è –¥–∞–∂–µ –≤ –≤—ã—Ö–æ–¥–Ω—ã–µ"),
                    Habit(name="–£—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ–ª–Ω—Ü–µ", description="–ü—Ä–æ–≤–µ—Å—Ç–∏ 15-20 –º–∏–Ω—É—Ç –Ω–∞ —É—Ç—Ä–µ–Ω–Ω–µ–º —Å–æ–ª–Ω—Ü–µ"),

                    # ü§ù –û—Ç–Ω–æ—à–µ–Ω–∏—è –∏ –õ–∏—á–Ω–æ—Å—Ç–Ω—ã–π —Ä–æ—Å—Ç
                    Habit(name="–ê–∫—Ç–∏–≤–Ω–æ–µ —Å–ª—É—à–∞–Ω–∏–µ", description="–°–ª—É—à–∞—Ç—å —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞, –Ω–µ –¥—É–º–∞—è –æ –æ—Ç–≤–µ—Ç–µ"),
                    Habit(name="–ì–ª—É–±–æ–∫–æ–µ –æ–±—â–µ–Ω–∏–µ", description="–ü—Ä–æ–≤–µ—Å—Ç–∏ –≤—Ä–µ–º—è —Å –±–ª–∏–∑–∫–∏–º–∏ –±–µ–∑ –≥–∞–¥–∂–µ—Ç–æ–≤"),
                    Habit(name="–ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ —á—Ç–µ–Ω–∏–µ", description="–ß–∏—Ç–∞—Ç—å 20-30 –º–∏–Ω—É—Ç –≤ –¥–µ–Ω—å"),
                    Habit(name="–í—ã—Ö–æ–¥ –∏–∑ –∑–æ–Ω—ã –∫–æ–º—Ñ–æ—Ä—Ç–∞", description="–°–¥–µ–ª–∞—Ç—å —á—Ç–æ-—Ç–æ –Ω–æ–≤–æ–µ –∏ –ø—É–≥–∞—é—â–µ–µ"),
                    Habit(name="–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ–µ —Ä–µ–≤—å—é", description="–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–¥–µ–ª—é –∏ —Å–æ—Å—Ç–∞–≤–∏—Ç—å –ø–ª–∞–Ω—ã")
                ]

                for habit in habits:
                    db.session.add(habit)

                db.session.commit()
                print("–ü—Ä–∏–≤—ã—á–∫–∏ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö!")
                for habit in habits:
                    db.session.add(habit)
                db.session.commit()
                print("‚úÖ –¢–µ—Å—Ç–æ–≤—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã!")
            else:
                print("‚úÖ –ü—Ä–∏–≤—ã—á–∫–∏ —É–∂–µ –µ—Å—Ç—å –≤ –±–∞–∑–µ")

            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –ë–î
            db_file_path = db_path.replace('sqlite:///', '')
            print(f"üìÅ –§–∞–π–ª –ë–î —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: {os.path.exists(db_file_path)}")
            if os.path.exists(db_file_path):
                print(f"üìÅ –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: {os.path.getsize(db_file_path)} –±–∞–π—Ç")

        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
            import traceback
            traceback.print_exc()


if __name__ == '__main__':
    debug_database()